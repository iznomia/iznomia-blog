---
wiki: oi-note
title: 转移优化
katex: true
updated: 2026-01-23
---

一般用 tD / eD 描述动态规划的规模，即有 $O(n^t)$ 个状态，每个状态通过 $O(n^e)$ 个子问题推出答案。

## wqs 二分

## 决策单调性

我们首先介绍四边形不等式。假设要求解最小值，如果有转移 $f_j\leftarrow f_i+w(i,j)$，且 $w$ 满足四边形不等式，即若 $a<b<c<d$，则 $w(a,d)+w(b,c)\ge w(a,c)+w(b,d)$，则具有决策单调性：随着 $i$ 的增大，转移点 $p_i$ 不降。

{% folding 证明 %}
采用反证法，存在 $p_j<p_i<i<j$，那么：

$$
f_{p_i}+w(p_i,i)\le f_{p_j}+w(p_j,i)\\
f_{p_j}+w(p_j,j)\le f_{p_i}+w(p_i,j)\\
$$

因此得到 $w(p_i,i)+w(p_j,j)\le w(p_j,i)+w(p_i,j)$，不满足四边形不等式。如果相等，说明两个不等式都是等式，$p_j$ 也可以转移到 $i$，那么 $p_i$ 不成立。
{% endfolding %}

### 分治处理

直接套用分治可以 $O(n\log n)$ 完成一层的转移，只要 $w$ 可以直接计算或者增量计算即可。

#### [PtzS2020-6] Rhythm Game

[Portal](https://qoj.ac/contest/506/problem/1355).

设 $f_{i,j}$ 代表前 $i$ 个音符敲击 $j$ 个？这样转移就需要枚举连续敲击之类的，不太方便。改为漏了 $j$ 个，还是不太方便，因此强制钦定第 $j$ 个漏了，这样可以在 $n+1$ 算答案，正好统计最后的 $P$。

转移就是 $f_{i,j}\leftarrow f_{k,j-1}+w(k+1,i-1)$，$w$ 满足四边形不等式，证明容易做差得到。

值得注意的是，当 $i>j$ 时，$w(i,j)$ 是不满足四边形不等式的，但是转移的时候却会出现这种情况，因此要把 $f_{i,dep}\leftarrow f_{i - 1, dep -1}$ 的转移单独拉出来。[代码](https://qoj.ac/submission/1954641)。

## 斜率优化

## 数据结构优化